import{r as g,j as t}from"./index-DjYihzQ-.js";import"./transform-BRg4-7h8.js";import{l as L}from"./linear-5fzD7ByX.js";import{m as q}from"./max-DBeXZoyG.js";import{l as K,a as Z}from"./line-CjDcKxmV.js";import{e as ee}from"./extent-Ccx1MofX.js";import"./string-CrOI-eyg.js";import"./path-CbwjOpE9.js";function F(e){return e<0?-1:1}function J(e,n,o){var f=e._x1-e._x0,c=n-e._x1,h=(e._y1-e._y0)/(f||c<0&&-0),d=(o-e._y1)/(c||f<0&&-0),p=(h*c+d*f)/(f+c);return(F(h)+F(d))*Math.min(Math.abs(h),Math.abs(d),.5*Math.abs(p))||0}function U(e,n){var o=e._x1-e._x0;return o?(3*(e._y1-e._y0)/o-n)/2:n}function G(e,n,o){var f=e._x0,c=e._y0,h=e._x1,d=e._y1,p=(h-f)/3;e._context.bezierCurveTo(f+p,c+p*n,h-p,d-p*o,h,d)}function N(e){this._context=e}N.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:G(this,this._t0,U(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var o=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,G(this,U(this,o=J(this,e,n)),o);break;default:G(this,this._t0,o=J(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=o}}};Object.create(N.prototype).point=function(e,n){N.prototype.point.call(this,n,e)};function Q(e){return new N(e)}const te="/data/solar_animation_2024.json",ne=()=>{const[e,n]=g.useState(null);return g.useEffect(()=>{fetch(te).then(o=>o.json()).then(o=>{n(o)}).catch(o=>{console.error("Error loading solar animation data:",o)})},[]),e},oe=({currentDayIndex:e,trailingDays:n,permanentDays:o,curves:f,dates:c,width:h,height:d,margin:p})=>{const l=h-p.left-p.right,S=d-p.top-p.bottom,b=g.useMemo(()=>L().domain([0,24*60]).range([0,l]),[l]),x=g.useMemo(()=>{const i=Object.values(f).flatMap(w=>w.map(M=>M.mw)),u=q(i)||2e4;return L().domain([0,u]).range([S,0]).nice()},[f,S]),j=g.useMemo(()=>K().x(i=>b(i.minute_of_day)).y(i=>x(i.mw)).curve(Q),[b,x]),y=g.useMemo(()=>{const i=[];o.forEach(u=>{u>=0&&u<c.length&&i.push({date:c[u],dayIndex:u,opacity:.4,strokeWidth:2,isPermanent:!0})});for(let u=n;u>=0;u--){const w=e-u;if(w>=0&&w<c.length){const M=c[w],D=u===0?1:Math.max(0,1-u/n),C=u===0?3:1.5;i.push({date:M,dayIndex:w,opacity:D,strokeWidth:C,isPermanent:!1})}}return i},[e,n,c,o]),W=[0,6,12,18,24];return t.jsxs("g",{transform:`translate(${p.left},${p.top})`,children:[t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:0,x2:0,y2:S,stroke:"#333",strokeWidth:1}),x.ticks(5).map(i=>t.jsxs("g",{transform:`translate(0,${x(i)})`,children:[t.jsx("line",{x1:0,x2:-6,y1:0,y2:0,stroke:"#333"}),t.jsxs("text",{x:-10,y:0,dy:"0.32em",textAnchor:"end",fontSize:12,fill:"#666",children:[(i/1e3).toFixed(0),"k MW"]})]},i)),t.jsx("text",{transform:`translate(-60,${S/2}) rotate(-90)`,textAnchor:"middle",fontSize:14,fill:"#333",fontWeight:"bold",children:"Solar Generation"})]}),t.jsxs("g",{transform:`translate(0,${S})`,children:[t.jsx("line",{x1:0,y1:0,x2:l,y2:0,stroke:"#333",strokeWidth:1}),W.map(i=>{const u=b(i*60);return t.jsxs("g",{transform:`translate(${u},0)`,children:[t.jsx("line",{x1:0,x2:0,y1:0,y2:6,stroke:"#333"}),t.jsx("text",{x:0,y:20,textAnchor:"middle",fontSize:12,fill:"#666",children:i===0?"12am":i<12?`${i}am`:i===12?"12pm":`${i-12}pm`})]},i)}),t.jsx("text",{x:l/2,y:45,textAnchor:"middle",fontSize:14,fill:"#333",fontWeight:"bold",children:"Time of Day (Pacific)"})]}),t.jsx("g",{opacity:.1,children:x.ticks(5).map(i=>t.jsx("line",{x1:0,x2:l,y1:x(i),y2:x(i),stroke:"#666"},i))}),t.jsx("g",{children:y.map(({date:i,dayIndex:u,opacity:w,strokeWidth:M,isPermanent:D})=>{const C=f[i];if(!C)return null;const E=j(C);if(!E)return null;let T="#999";return D?T=u===e?"#ff8c00":"#e74c3c":w===1&&(T="#ff8c00"),t.jsx("path",{d:E,fill:"none",stroke:T,strokeWidth:M,opacity:w},`${i}-${D?"permanent":"current"}`)})})]})},se=({dailyTotals:e,currentDayIndex:n,hoveredDayIndex:o,width:f,height:c,margin:h,onHover:d,onClick:p,interactive:l,showCurrentDay:S=!0})=>{const b=f-h.left-h.right,x=c-h.top-h.bottom,{xScale:j,yScale:y,lineGenerator:W}=g.useMemo(()=>{const r=e.map(a=>({...a,dateObj:new Date(a.date)})),m=Z().domain(ee(r,a=>a.dateObj)).range([0,b]),_=q(e,a=>a.total_mwh)||2e5,k=L().domain([0,_]).range([x,0]).nice(),s=K().x(a=>m(a.dateObj)).y(a=>k(a.total_mwh)).curve(Q);return{xScale:m,yScale:k,lineGenerator:s,dataWithDates:r}},[e,b,x]),i=new Date(e[n].date),u=j(i),w=r=>{if(!l)return;const m=r.currentTarget.getBoundingClientRect(),_=r.clientX-m.left,k=j.invert(_),s=e.findIndex(a=>{const v=new Date(a.date);return Math.abs(v.getTime()-k.getTime())<12*60*60*1e3});s!==-1&&s!==o&&d(s)},M=()=>{l&&d(null)},D=r=>{if(!l)return;const m=r.currentTarget.getBoundingClientRect(),_=r.clientX-m.left,k=j.invert(_),s=e.findIndex(a=>{const v=new Date(a.date);return Math.abs(v.getTime()-k.getTime())<12*60*60*1e3});s!==-1&&p(s)},C=r=>{if(!l)return;r.preventDefault();const m=r.currentTarget.getBoundingClientRect(),_=r.touches[0].clientX-m.left,k=j.invert(_),s=e.findIndex(a=>{const v=new Date(a.date);return Math.abs(v.getTime()-k.getTime())<12*60*60*1e3});s!==-1&&d(s)},E=r=>{if(!l)return;r.preventDefault();const m=r.currentTarget.getBoundingClientRect(),_=r.touches[0].clientX-m.left,k=j.invert(_),s=e.findIndex(a=>{const v=new Date(a.date);return Math.abs(v.getTime()-k.getTime())<12*60*60*1e3});s!==-1&&s!==o&&d(s)},T=r=>{l&&(r.preventDefault(),o!==null&&p(o),d(null))},A=o!==null?j(new Date(e[o].date)):null,$=g.useMemo(()=>{const r=[];for(let m=0;m<12;m++)r.push(new Date(2024,m,1));return r},[]),H=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],R=W(e.map(r=>({...r,dateObj:new Date(r.date)}))),z=(r=>{const[m,_,k]=r.split("-").map(Number);return`${new Date(m,_-1,k).toLocaleDateString("en-US",{month:"long"})} ${k}, ${m}`})(e[o??n].date);return t.jsxs("g",{transform:`translate(${h.left},${h.top})`,children:[l&&t.jsx("text",{x:b,y:-5,textAnchor:"end",fontSize:12,fill:"#888",fontWeight:"500",children:z}),t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:0,x2:0,y2:x,stroke:"#333",strokeWidth:1}),y.ticks(3).map(r=>t.jsxs("g",{transform:`translate(0,${y(r)})`,children:[t.jsx("line",{x1:0,x2:-6,y1:0,y2:0,stroke:"#333"}),t.jsxs("text",{x:-10,y:0,dy:"0.32em",textAnchor:"end",fontSize:10,fill:"#666",children:[(r/1e3).toFixed(0),"k"]})]},r)),t.jsx("text",{transform:`translate(-50,${x/2}) rotate(-90)`,textAnchor:"middle",fontSize:12,fill:"#333",fontWeight:"bold",children:"Daily MWh"})]}),t.jsxs("g",{transform:`translate(0,${x})`,children:[t.jsx("line",{x1:0,y1:0,x2:b,y2:0,stroke:"#333",strokeWidth:1}),$.map((r,m)=>{const _=j(r);return t.jsxs("g",{transform:`translate(${_},0)`,children:[t.jsx("line",{x1:0,x2:0,y1:0,y2:6,stroke:"#333"}),t.jsx("text",{x:0,y:18,textAnchor:"middle",fontSize:10,fill:"#666",children:H[m]})]},m)})]}),t.jsx("g",{opacity:.1,children:y.ticks(3).map(r=>t.jsx("line",{x1:0,x2:b,y1:y(r),y2:y(r),stroke:"#666"},r))}),R&&t.jsx("path",{d:R,fill:"none",stroke:"#ff8c00",strokeWidth:2,opacity:.6}),S&&t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:u,y1:0,x2:u,y2:x,stroke:"#e74c3c",strokeWidth:3}),t.jsx("circle",{cx:u,cy:y(e[n].total_mwh),r:5,fill:"#e74c3c"})]}),l&&A!==null&&t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:A,y1:0,x2:A,y2:x,stroke:"#666",strokeWidth:1,strokeDasharray:"4,4",opacity:.6,pointerEvents:"none"}),t.jsx("circle",{cx:A,cy:y(e[o].total_mwh),r:4,fill:"#666",opacity:.8,pointerEvents:"none"})]}),t.jsx("rect",{x:0,y:0,width:b,height:x,fill:"transparent",onMouseMove:w,onMouseLeave:M,onClick:D,onTouchStart:C,onTouchMove:E,onTouchEnd:T,style:{cursor:l?"pointer":"default",touchAction:"none"}})]})},re=({isPlaying:e,onPlayPause:n,currentDate:o,keyDateInfo:f})=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"20px"},children:[t.jsx("button",{onClick:n,style:{fontSize:"18px",padding:"12px 32px",backgroundColor:"#ff8c00",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.2s"},onMouseEnter:c=>{c.currentTarget.style.backgroundColor="#e67e00"},onMouseLeave:c=>{c.currentTarget.style.backgroundColor="#ff8c00"},children:e?"⏸ Pause":"▶ Play"}),t.jsx("div",{style:{fontSize:"16px",color:"#666",fontWeight:"500"},children:new Date(o).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),ie=({step:e})=>{const o=[{title:"California Solar Generation 2024",text:"Explore how solar power production changes throughout the year"},{title:"A Single Day",text:"This shows solar generation on June 21, 2024. Power increases as the sun rises, peaks around 1 PM, then falls as the sun sets."},{title:"Weather Matters",text:"Two days later on June 23, atmospheric conditions like clouds and fog reduce solar output compared to the clear day."},{title:"The Year at a Glance",text:"The bottom chart shows the entire year of 2024. Each point represents total daily generation. Notice the seasonal pattern - higher in summer, lower in winter."},{title:"Lowest Generation",text:"January 22 had the lowest generation - short winter day combined with cloudy weather."},{title:"Peak Generation",text:"June 29 had peak generation - long sunny summer day with maximum capacity."},{title:"The Full Year",text:"Watch the complete year animate, showing seasonal patterns and daily variations."},{title:"Explore Yourself",text:"Hover over the timeline to explore any day. Click to pin days for comparison."}][e];return t.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"calc(100vw - 60px)",maxWidth:"500px",margin:"0",padding:"clamp(20px, 4vw, 30px)",backgroundColor:"rgba(255, 255, 255, 0.95)",border:"2px solid #ff8c00",borderRadius:"12px",textAlign:"center",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.2)",zIndex:100,pointerEvents:e===0?"auto":"none"},children:[t.jsx("h2",{style:{margin:"0 0 15px 0",color:"#333",fontSize:"clamp(20px, 4vw, 24px)",fontWeight:"bold"},children:o.title}),t.jsx("p",{style:{margin:0,color:"#555",fontSize:"clamp(14px, 3vw, 16px)",lineHeight:"1.6"},children:o.text})]})},ae=({step:e,totalSteps:n,onNext:o,onBack:f})=>{const c=e===0,h=e===n-1;return t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"20px",padding:"20px"},children:[!c&&t.jsx("button",{onClick:f,style:{fontSize:"16px",padding:"10px 24px",backgroundColor:"#ddd",color:"#333",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:"← Back"}),t.jsxs("div",{style:{fontSize:"14px",color:"#888",fontWeight:"500"},children:[e+1," / ",n]}),!h&&t.jsx("button",{onClick:o,style:{fontSize:"16px",padding:"10px 24px",backgroundColor:"#ff8c00",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"background-color 0.2s"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="#e67e00"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="#ff8c00"},children:e===0?"Begin →":"Next →"})]})},ce=100,Y=8,le=()=>{const[e,n]=g.useState({width:1e3,curvesHeight:400,overviewHeight:150});return g.useEffect(()=>{const o=()=>{const c=window.innerWidth-40,h=1e3,d=400,p=150,l=320,S=250,b=100,x=Math.max(Math.min(c,h),l),j=x/h,y=Math.max(Math.min(d*j,d),S),W=Math.max(Math.min(p*j,p),b);n({width:x,curvesHeight:y,overviewHeight:W})};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),e},de=e=>{const n=e<600;return{curves:{top:40,right:n?20:40,bottom:n?50:60,left:n?50:80},overview:{top:20,right:n?20:40,bottom:n?35:40,left:n?50:80}}};function we(){const e=ne(),[n,o]=g.useState(0),[f,c]=g.useState(0),[h,d]=g.useState(!1),[p,l]=g.useState(new Set),[S,b]=g.useState(null),x=g.useRef(null),j=g.useRef(Date.now()),{width:y,curvesHeight:W,overviewHeight:i}=le(),u=de(y),w=(e==null?void 0:e.daily_totals.findIndex(s=>s.date==="2024-06-21"))??0,M=(e==null?void 0:e.daily_totals.findIndex(s=>s.date==="2024-06-23"))??14,D=(e==null?void 0:e.daily_totals.findIndex(s=>{var a;return s.date===((a=e==null?void 0:e.key_dates.find(v=>v.label==="Minimum Generation Day"))==null?void 0:a.date)}))??21,C=(e==null?void 0:e.daily_totals.findIndex(s=>{var a;return s.date===((a=e==null?void 0:e.key_dates.find(v=>v.label==="Peak Generation Day"))==null?void 0:a.date)}))??180;g.useEffect(()=>{if(e)switch(n){case 1:c(w),l(new Set);break;case 2:c(M),l(new Set([w]));break;case 3:const s=w+4;c(s),l(new Set);break;case 4:c(D),l(new Set([D]));break;case 5:c(C),l(new Set([D,C]));break;case 6:c(0),l(new Set),d(!0);break;case 7:d(!1);break}},[n,e,w,M,D,C]),g.useEffect(()=>{if(!h||!e||n!==6)return;const s=()=>{const a=Date.now();a-j.current>=ce&&(c(B=>{const I=B+1;if(I<e.metadata.total_days){const V=e.daily_totals[I].date;return e.key_dates.find(P=>P.date===V&&(P.label==="Peak Generation Day"||P.label==="Minimum Generation Day"))&&l(P=>new Set(P).add(I)),I}else return d(!1),o(7),B}),j.current=a),x.current=requestAnimationFrame(s)};return x.current=requestAnimationFrame(s),()=>{x.current&&cancelAnimationFrame(x.current)}},[h,e,n]);const E=()=>{n<Y-1&&o(n+1)},T=()=>{n>0&&(o(n-1),d(!1))};g.useEffect(()=>{n===7&&(l(new Set),b(null))},[n]);const A=s=>{n===7&&b(s)},$=s=>{n===7&&l(a=>{const v=new Set(a);return v.has(s)?v.delete(s):v.add(s),v})};if(!e)return t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"24px",color:"#666"},children:"Loading solar data..."});const H=n===3?7:0,R=u.curves,X=u.overview,O=e.daily_totals.map(s=>s.date),z=n===7?S!==null?S:-1:S??f,r=O[z>=0?z:f],m=e.key_dates.find(s=>{var a;return s.date===((a=e.daily_totals[f])==null?void 0:a.date)&&(s.label==="Peak Generation Day"||s.label==="Minimum Generation Day")})||null,_=n>=3,k=n===6;return t.jsxs("div",{className:"solar-animation-container",children:[n>=0&&n<7&&t.jsx("div",{style:{position:"relative",minHeight:"60px",textAlign:"center",marginBottom:"40px"},children:t.jsx(ie,{step:n})}),n===7&&t.jsxs("div",{style:{textAlign:"center",marginBottom:"40px",color:"#666",fontSize:"clamp(14px, 3vw, 16px)"},children:[t.jsx("strong",{children:"Explore:"})," Hover (or drag on mobile) over the timeline to see any day. Click or release to pin days for comparison."]}),t.jsx(ae,{step:n,totalSteps:Y,onNext:E,onBack:T}),k&&t.jsx(re,{isPlaying:h,onPlayPause:()=>d(!h),currentDate:r,keyDateInfo:m}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"40px"},children:[t.jsx("svg",{width:y,height:W,children:t.jsx(oe,{currentDayIndex:n===0||n===3?-1:z,trailingDays:H,permanentDays:n===0||n===3?new Set:p,curves:e.intraday_curves,dates:O,width:y,height:W,margin:R})}),_&&t.jsx("svg",{width:y,height:i,children:t.jsx(se,{dailyTotals:e.daily_totals,currentDayIndex:f,hoveredDayIndex:S,width:y,height:i,margin:X,onHover:A,onClick:$,interactive:n===7,showCurrentDay:n!==3&&n!==7})})]}),n===7&&p.size>0&&t.jsx("div",{style:{textAlign:"center",marginTop:"20px"},children:t.jsx("button",{onClick:()=>l(new Set),style:{fontSize:"14px",padding:"8px 20px",backgroundColor:"#ddd",color:"#333",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500"},children:"Clear All Pinned Days"})}),n===7&&t.jsxs("div",{style:{marginTop:"40px",padding:"20px",borderTop:"1px solid #ddd",textAlign:"center"},children:[t.jsx("p",{style:{margin:"0 0 8px 0",fontSize:"12px",color:"#888"},children:t.jsx("strong",{children:"Data Sources:"})}),t.jsxs("p",{style:{margin:"0",fontSize:"11px",color:"#999",lineHeight:"1.6"},children:["Solar generation data from"," ",t.jsx("a",{href:"https://www.caiso.com/",target:"_blank",rel:"noopener noreferrer",style:{color:"#ff8c00"},children:"CAISO"})," ","(California Independent System Operator) via"," ",t.jsx("a",{href:"https://github.com/kmax12/gridstatus",target:"_blank",rel:"noopener noreferrer",style:{color:"#ff8c00"},children:"GridStatus"}),". Solar irradiance data from NREL's"," ",t.jsx("a",{href:"https://nsrdb.nrel.gov/",target:"_blank",rel:"noopener noreferrer",style:{color:"#ff8c00"},children:"NSRDB"})," ","(National Solar Radiation Database)."]})]})]})}export{we as default};
