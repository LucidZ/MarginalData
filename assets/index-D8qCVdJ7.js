import{r as m,j as n}from"./index-EHeVb_aQ.js";function V(g,b,R){g/=255,b/=255,R/=255;const w=Math.max(g,b,R),f=Math.min(g,b,R);let v=0,P=0;const c=(w+f)/2;if(w!==f){const M=w-f;switch(P=c>.5?M/(2-w-f):M/(w+f),w){case g:v=((b-R)/M+(b<R?6:0))/6;break;case b:v=((R-g)/M+2)/6;break;case R:v=((g-b)/M+4)/6;break}}return{h:v,s:P,l:c}}function Z(){const[g,b]=m.useState(!1),[R,w]=m.useState(!1),[f,v]=m.useState(!1),[P,c]=m.useState(""),[M,U]=m.useState("https://picsum.photos/400/300"),[H,q]=m.useState(5),T=m.useRef(null),S=m.useRef(null),I=m.useRef(null),X=m.useRef([]),N=m.useRef([]),d=m.useRef(null),D=m.useRef(null),$=async()=>{const t=M.trim();if(!t){c("Please enter an image URL");return}c("Loading image...");try{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const o=e.width,h=e.height,r=T.current,a=S.current,s=I.current;if(!r||!a||!s)return;r.width=o,r.height=h,a.width=o,a.height=h,s.width=o,s.height=h;const i=r.getContext("2d",{willReadFrequently:!0});i&&(i.drawImage(e,0,0),d.current=i.getImageData(0,0,o,h),B(),b(!0),c(""))},e.onerror=()=>{c("Failed to load image. Try a different URL or check CORS settings.")},e.src=t}catch(e){c(`Error loading image: ${e}`)}},B=()=>{if(!d.current)return;const t=[],e=d.current.data,o=d.current.width,h=d.current.height;for(let r=0;r<h;r++)for(let a=0;a<o;a++){const s=(r*o+a)*4,i=e[s],l=e[s+1],u=e[s+2],y=e[s+3],j=V(i,l,u);t.push({x:a,y:r,r:i,g:l,b:u,a:y,hue:j.h,saturation:j.s,lightness:j.l})}X.current=t},Y=(t,e)=>{!d.current||!S.current||(c(e),setTimeout(()=>{N.current=[...X.current].sort(t);const o=d.current.width,h=d.current.height,r=S.current.getContext("2d");if(!r)return;const a=r.createImageData(o,h);N.current.forEach((s,i)=>{const l=i%o,u=Math.floor(i/o),y=(u*o+l)*4;a.data[y]=s.r,a.data[y+1]=s.g,a.data[y+2]=s.b,a.data[y+3]=s.a,s.sortedX=l,s.sortedY=u}),r.putImageData(a,0,0),w(!0),c("")},10))},O=()=>{Y((t,e)=>t.hue-e.hue,"Sorting pixels by hue...")},G=()=>{Y((t,e)=>t.hue+t.lightness-(e.hue+e.lightness),"Sorting pixels by hue + lightness...")},J=()=>{Y(()=>Math.random()-.5,"Shuffling pixels randomly...")},K=()=>{!d.current||!S.current||(c("Shuffling pixels nearby..."),setTimeout(()=>{const t=d.current.width,e=d.current.height,o=S.current.getContext("2d");if(!o)return;const h=Math.min(t,e)*.3,r=[...X.current].map(s=>{const i=Math.random()*2*Math.PI,l=Math.random()*h,u=Math.round(s.x+Math.cos(i)*l),y=Math.round(s.y+Math.sin(i)*l),j=Math.max(0,Math.min(t-1,u)),p=Math.max(0,Math.min(e-1,y));return{...s,sortedX:j,sortedY:p}});N.current=r;const a=o.createImageData(t,e);r.forEach(s=>{const i=s.sortedX,u=(s.sortedY*t+i)*4;a.data[u]=s.r,a.data[u+1]=s.g,a.data[u+2]=s.b,a.data[u+3]=s.a}),o.putImageData(a,0,0),w(!0),c("")},10))},z=()=>{if(!d.current||!I.current)return;const t=H,e=[0];for(let p=1;p<t;p++)e.push(1-Math.pow(.5,p));e.push(1),c(`Step 1/${t}: ${(e[1]*100).toFixed(1)}% home`),v(!0);const o=d.current.width,h=d.current.height,r=I.current.getContext("2d");if(!r)return;r.fillStyle="#f0f0f0",r.fillRect(0,0,o,h);let a=0;const s=600,i=200;let l=Date.now(),u=!1;const y=p=>{const C=r.createImageData(o,h);N.current.forEach(x=>{const A=x.sortedX+(x.x-x.sortedX)*p,E=x.sortedY+(x.y-x.sortedY)*p,k=Math.round(A),F=Math.round(E);if(k>=0&&k<o&&F>=0&&F<h){const L=(F*o+k)*4;C.data[L]=x.r,C.data[L+1]=x.g,C.data[L+2]=x.b,C.data[L+3]=x.a}}),r.putImageData(C,0,0)},j=()=>{const p=Date.now()-l;if(u){if(p>=i){if(u=!1,a++,a>=t){c("Complete!"),setTimeout(()=>{c(""),v(!1)},1e3);return}l=Date.now();const F=e[a+1];c(`Step ${a+1}/${t}: ${(F*100).toFixed(1)}% home`)}D.current=requestAnimationFrame(j);return}const C=Math.min(p/s,1),x=1-Math.pow(1-C,3),A=e[a],E=e[a+1],k=A+(E-A)*x;y(k),C<1||(u=!0,l=Date.now()),D.current=requestAnimationFrame(j)};j()},Q=()=>{if(D.current&&(cancelAnimationFrame(D.current),D.current=null),S.current){const t=S.current.getContext("2d");t&&t.clearRect(0,0,S.current.width,S.current.height)}if(I.current){const t=I.current.getContext("2d");t&&t.clearRect(0,0,I.current.width,I.current.height)}N.current=[],w(!1),v(!1),c("")};return n.jsxs("div",{className:"image-scrambler",children:[n.jsxs("header",{children:[n.jsx("h1",{children:"Image Scrambler"}),n.jsx("p",{className:"subtitle",children:"Sort pixels by hue, then watch them return home"})]}),n.jsxs("div",{className:"input-section",children:[n.jsxs("div",{className:"input-group",children:[n.jsx("input",{type:"text",value:M,onChange:t=>U(t.target.value),placeholder:"Paste image URL (JPG or PNG)...",onKeyDown:t=>t.key==="Enter"&&$()}),n.jsx("button",{onClick:$,children:"Load Image"})]}),n.jsxs("div",{className:"controls",children:[n.jsx("button",{onClick:O,disabled:!g||f,children:"Sort by Hue"}),n.jsx("button",{onClick:G,disabled:!g||f,children:"Sort by Hue + Lightness"}),n.jsx("button",{onClick:J,disabled:!g||f,children:"Sort Randomly"}),n.jsx("button",{onClick:K,disabled:!g||f,children:"Shuffle Nearby"}),n.jsxs("div",{className:"steps-control",children:[n.jsx("label",{htmlFor:"numSteps",children:"Animation steps:"}),n.jsx("input",{id:"numSteps",type:"number",min:"2",max:"10",value:H,onChange:t=>q(Math.max(2,Math.min(10,parseInt(t.target.value)||2))),disabled:f})]}),n.jsx("button",{onClick:z,disabled:!R||f,children:"Animate Return"}),n.jsx("button",{onClick:Q,disabled:!g,children:"Reset"})]})]}),P&&n.jsx("div",{className:"status",children:P}),n.jsxs("div",{className:"canvas-container",children:[n.jsxs("div",{className:"canvas-wrapper",children:[n.jsx("h2",{children:"Original"}),n.jsx("canvas",{ref:T})]}),n.jsxs("div",{className:"canvas-wrapper",children:[n.jsx("h2",{children:"Sorted by Hue"}),n.jsx("canvas",{ref:S})]}),n.jsxs("div",{className:"canvas-wrapper animation-canvas",children:[n.jsx("h2",{children:"Animation: Pixels Returning Home"}),n.jsx("canvas",{ref:I})]})]})]})}export{Z as default};
